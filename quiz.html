<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Taste Quiz</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    h1 { margin-bottom: 24px; }
    .question { margin-bottom: 20px; }
    button { padding: 10px 16px; cursor: pointer; }
  </style>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
<script>
  const supabase = window.supabase.createClient(
    "https://nqcmlwtwsfivcyarurwr.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xY21sd3R3c2ZpdmN5YXJ1cndyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0ODM0MDIsImV4cCI6MjA3MjA1OTQwMn0.UGie7ib7PYIZHQcGpwQKk5O2xGMvn5_NCDGKEht1biQ"
  );
</script>
</head>
<body>
  <h1>Discover Your Style</h1>

  <div id="quiz">
    <div class="question">
      <p><strong>1. What style speaks to you most?</strong></p>
      <label><input type="radio" name="style" value="Minimalist"> Minimalist</label><br>
      <label><input type="radio" name="style" value="Mid-Century"> Mid-Century</label><br>
      <label><input type="radio" name="style" value="Rustic"> Rustic</label><br>
      <label><input type="radio" name="style" value="Modern"> Modern</label>
    </div>

    <div class="question">
      <p><strong>2. What’s your ideal budget range?</strong></p>
      <label><input type="radio" name="budget" value="<$500"> <$500</label><br>
      <label><input type="radio" name="budget" value="$500-$1500"> $500–$1500</label><br>
      <label><input type="radio" name="budget" value="$1500-$3000"> $1500–$3000</label><br>
      <label><input type="radio" name="budget" value="$3000+"> $3000+</label>
    </div>

    <div class="question">
      <p><strong>3. Which room are you focused on?</strong></p>
      <label><input type="radio" name="room" value="Living Room"> Living Room</label><br>
      <label><input type="radio" name="room" value="Bedroom"> Bedroom</label><br>
      <label><input type="radio" name="room" value="Dining Room"> Dining Room</label><br>
      <label><input type="radio" name="room" value="Office"> Office</label>
    </div>

    <button onclick="submitQuiz()">Save My Answers</button>
  </div>

  <div id="status"></div>

        <form id="quiz-form">
  <label>Style:</label><br>
  <select name="style" required>
    <option value="Mid-Century">Mid-Century</option>
    <option value="Modern">Modern</option>
    <option value="Boho">Boho</option>
  </select><br><br>

  <label>Budget:</label><br>
  <select name="budget" required>
    <option value="<$500">Under $500</option>
    <option value="$500-$1500">$500–$1500</option>
    <option value="$1500+">$1500+</option>
  </select><br><br>

  <label>Room:</label><br>
  <select name="room" required>
    <option value="Living Room">Living Room</option>
    <option value="Bedroom">Bedroom</option>
    <option value="Dining Room">Dining Room</option>
  </select><br><br>

  <button type="submit">See My Matches</button>
</form>

  <script src="/config.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const client = supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);

    async function submitQuiz() {
      const style = document.querySelector('input[name="style"]:checked')?.value;
      const budget = document.querySelector('input[name="budget"]:checked')?.value;
      const room = document.querySelector('input[name="room"]:checked')?.value;

      const { data: { user } } = await client.auth.getUser();
      if (!user) {
        document.getElementById('status').textContent = "Please sign in first!";
        return;
      }

      const answers = { style, budget, room };

      const { error } = await client
        .from('quiz_responses')
        .insert([{ user_id: user.id, answers }]);

      if (error) {
        document.getElementById('quiz').style.display = "none";
        document.getElementById('status').innerHTML = `
          <p>Great! Your answers are saved.</p>
          <button onclick="goToMatches()">Show Me My Matches</button>
       `;

function goToMatches() {
  window.location.href = "/index.html";
}

      }
    }
  </script>

        <script>
  const form = document.getElementById("quiz-form");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    // Grab answers from the form
    const answers = {
      style: form.style.value,
      budget: form.budget.value,
      room: form.room.value
    };

    // Get the logged-in user
    const { data: { user }, error: userError } = await supabase.auth.getUser();
    if (userError || !user) {
      alert("You need to log in first.");
      return;
    }

    // Save quiz response to Supabase
    const { error } = await supabase
      .from("quiz_responses")
      .insert([{ user_id: user.id, answers }]);

    if (error) {
      console.error("Error saving quiz:", error);
      alert("Something went wrong saving your quiz.");
      return;
    }

    // Redirect to products page
    window.location.href = "products.html";
  });
</script>
</body>
</html>
