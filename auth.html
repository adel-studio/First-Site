<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Login</title>
  <style>
    body { font-family: sans-serif; margin: 40px; max-width: 500px; }
    h2 { margin-bottom: 16px; }
    input { display: block; margin-bottom: 12px; padding: 8px; width: 100%; }
    button { padding: 10px 16px; cursor: pointer; }
    #status { margin-top: 20px; }
  </style>
</head>
<body>
  <h2>Sign Up / Sign In</h2>

  <div id="form">
    <input id="firstName" type="text" placeholder="First Name" />
    <input id="lastName" type="text" placeholder="Last Name" />
    <input id="email" type="email" placeholder="Email" />
    <button onclick="signIn()">Send Magic Link</button>
  </div>

  <div id="status"></div>

  <script src="/config.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const client = supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);

    // Handle sign-in request
    async function signIn() {
      const email = document.querySelector('#email').value;
      const firstName = document.querySelector('#firstName').value;
      const lastName = document.querySelector('#lastName').value;

      const { error } = await client.auth.signInWithOtp({
        email,
        options: {
          data: { firstName, lastName } // save into user_metadata
        }
      });

      document.getElementById('status').textContent = error 
        ? error.message 
        : "Check your email for the magic link!";
    }

    // Handle redirect after clicking magic link
    async function handleRedirect() {
      const { data, error } = await client.auth.getSession();

      if (error) {
        document.getElementById('status').textContent = "Login error: " + error.message;
        return;
      }

      if (data.session) {
  // User is logged in â†’ send them to quiz
  window.location.href = "/quiz.html"
    ;
}

    }

    handleRedirect();
  </script>
</body>
</html>
